<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¯ãƒ©ã‚¹æ–°è è¨˜è€…æŠ•ç¨¿ãƒã‚¹ãƒˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
      body { background-color: #e0f7fa; padding: 20px; font-family: "M PLUS Rounded 1c", sans-serif; }
      .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; border: 4px solid #00acc1; }
      h1 { color: #00838f; text-align: center; font-size: 1.8rem; margin-bottom: 20px; border-bottom: 3px dashed #b2ebf2; padding-bottom: 10px; }
      label { font-weight: bold; color: #444; margin-top: 15px; }
      input, textarea, select { border: 2px solid #b2ebf2 !important; border-radius: 10px !important; }
      .btn-send { background-color: #ff9800; border: none; font-weight: bold; width: 100%; margin-top: 30px; border-radius: 50px; padding: 15px; font-size: 1.2rem; box-shadow: 0 4px 0 #e65100; transition: transform 0.1s; }
      .btn-send:active { transform: translateY(4px); box-shadow: none; }
      .btn-send:disabled { background-color: #ccc; box-shadow: none; cursor: not-allowed; }
      
      .loader { display: none; text-align: center; margin-top: 15px; color: #00838f; font-weight: bold; }
      .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid #b2ebf2; border-top: 3px solid #00838f; border-radius: 50%; animation: spin 1s linear infinite; vertical-align: middle; margin-right: 10px; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 1000; animation: fadeIn 0.3s; }
      .modal-content { background: white; width: 85%; max-width: 400px; margin: 20vh auto; padding: 30px; border-radius: 20px; text-align: center; border: 5px solid #ffeb3b; animation: popIn 0.4s; }
      .emoji { font-size: 4rem; display: block; margin-bottom: 10px; animation: bounce 1s infinite; }
      
      @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
      @keyframes popIn { from { transform: scale(0.8); opacity:0; } to { transform: scale(1); opacity:1; } }
      @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ“° ã‚¯ãƒ©ã‚¹æ–°è è¨˜è€…æŠ•ç¨¿ãƒã‚¹ãƒˆ</h1>
      <p style="text-align:center; font-size:0.9rem; color:#666;">ç‰¹ãƒ€ãƒã‚’è¦‹ã¤ã‘ã¦ã€ã¿ã‚“ãªã«æ•™ãˆã‚ˆã†ï¼</p>
      
      <form id="articleForm" onsubmit="submitForm(event)">
        <label>ğŸ“ è¨˜è€…åï¼ˆã‚ãªãŸã®åå‰ï¼‰<input type="text" name="reporterName" required placeholder="ä¾‹ï¼šå±±ç”° ãŸã‚ã†"></label>
        
        <!-- è¿½åŠ : ã‚¿ã‚°é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ -->
        <label>ğŸ·ï¸ ã‚¿ã‚°ï¼ˆãˆã‚‰ã‚“ã§ã­ï¼‰
          <select name="tag" id="tagSelect">
            <option value="">ï¼ˆé¸æŠã—ãªã„ï¼‰</option>
            <option disabled>èª­ã¿è¾¼ã¿ä¸­...</option>
          </select>
        </label>
        
        <label>ğŸ“¢ è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«<input type="text" name="title" required placeholder="ä¾‹ï¼šçµ¦é£Ÿã®ã‚«ãƒ¬ãƒ¼ãŒå¤§äººæ°—ï¼"></label>
        <label>ğŸ“– è¨˜äº‹ã®å†…å®¹<textarea name="body" rows="6" required placeholder="ã„ã¤ã€ã©ã“ã§ã€ã ã‚ŒãŒã€ã©ã†ã—ãŸã‹ãªï¼Ÿ"></textarea></label>
        <label>ğŸ“· å†™çœŸï¼ˆ1æšã ã‘ï¼‰<input type="file" name="imageFile" accept="image/*"></label>
        
        <button type="submit" class="btn-send" id="submitBtn">ğŸ“® è¨˜äº‹ã‚’ãƒã‚¹ãƒˆã«å…¥ã‚Œã‚‹ï¼</button>
        <div id="loader" class="loader"><div class="spinner"></div>è¨˜äº‹ã‚’å±Šã‘ã¦ã„ã¾ã™...</div>
      </form>
      <div style="text-align:center; margin-top:30px; font-size:0.8rem;">
        <a href="<?= ScriptApp.getService().getUrl() ?>?p=admin" target="_top">ğŸ”§ å…ˆç”Ÿç”¨ç·¨é›†å®¤ã¸</a>
      </div>
    </div>

    <div id="successModal" class="modal-overlay">
      <div class="modal-content">
        <span class="emoji">ğŸ‰</span>
        <h2 style="color:#2e7d32; margin-bottom:10px;">é€ä¿¡å®Œäº†ï¼</h2>
        <p id="successMsg" style="font-weight:bold; color:#555; margin-bottom:20px;"></p>
        <button onclick="closeModal()" style="background:#00acc1; color:white; border:none; padding:10px 30px; border-radius:30px; font-weight:bold; font-size:1.1rem; cursor:pointer;">OK!</button>
      </div>
    </div>

    <script>
      // ç”»é¢èª­ã¿è¾¼ã¿æ™‚ã«ã‚¿ã‚°ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«å…¥ã‚Œã‚‹
      window.onload = function() {
        google.script.run.withSuccessHandler(tags => {
          const select = document.getElementById('tagSelect');
          // ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
          select.innerHTML = '<option value="">ï¼ˆé¸æŠã—ãªã„ï¼‰</option>';
          
          tags.forEach(tag => {
            const option = document.createElement('option');
            option.value = tag;
            option.text = tag;
            select.add(option);
          });
        }).getSchoolTags();
      };

      function submitForm(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const loader = document.getElementById('loader');
        
        btn.disabled = true;
        btn.innerText = "é€ä¿¡ä¸­...";
        loader.style.display = 'block';

        google.script.run.withSuccessHandler(onSuccess).withFailureHandler(onFailure).saveArticle(document.getElementById('articleForm'));
      }

      function onSuccess() {
        const messages = ["ã™ã”ã„ï¼ã„ã„è¨˜äº‹ã ã­ï¼", "ã‚ã‚ŠãŒã¨ã†ï¼åŠ©ã‹ã‚‹ã‚ˆï¼", "ãã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€çŸ¥ã‚‰ãªã‹ã£ãŸï¼", "è¨˜è€…ã¨ã—ã¦ã®æ‰èƒ½ãŒã‚ã‚‹ã­ï¼", "ã¿ã‚“ãªå–œã¶ã‚ˆï¼"];
        document.getElementById('successMsg').innerText = messages[Math.floor(Math.random() * messages.length)];
        document.getElementById('articleForm').reset();
        
        resetButton();
        document.getElementById('successModal').style.display = 'block';
      }

      function onFailure(e) {
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + e.message);
        resetButton();
      }

      function resetButton() {
        const btn = document.getElementById('submitBtn');
        btn.disabled = false;
        btn.innerText = "ğŸ“® è¨˜äº‹ã‚’ãƒã‚¹ãƒˆã«å…¥ã‚Œã‚‹ï¼";
        document.getElementById('loader').style.display = 'none';
      }

      function closeModal() {
        document.getElementById('successModal').style.display = 'none';
      }
    </script>
  </body>
</html>
